<!DOCTYPE html>
<html ng-app data-cast-api-enabled="true">
<head>

<!--
 *
 * FM4cast - FM4 chromecasts receiver/sender
 * http://sehaas.github.io/fm4cast
 *
 * Copyright 2013,2014 Sebastian Haas (sehaas@deebas.com)
 * Released under the MIT license
 *
 *
//-->
 
	<title>FM4 chromecast Player</title>
	<script src="../js/jquery.min.js"></script>
	<script src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<script src="../js/jsrender.js"></script>

	<script src="../js/apikey.js"></script><!-- make sure your apikeyfile is there -->
	<script src="../js/CastPlayer.js"></script>
	<script src="../js/FM4Sender.js"></script>
	<link href="//code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" rel="stylesheet" type="text/css" >
	<link href="../css/FM4Sender.css" rel="stylesheet" type="text/css" >
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
</head>
	<style type="text/css">
		.player {
			width:500px;
			height:200px;
			background-color:white;
		}

		.upper {
			display: inline-block;
			height:75%;
			width:100%;
		}

		.upper > div {
			float:left;
			height: 100%;
		}

		.upper:after{
			content:'.';
			display: none;
			clear:both;
		}

		.mediaimage {
			width:25%;
			background-size: contain;
			background-position: 50%;
			background-repeat: no-repeat;
		}

		.mediainfo {
			width: 50%;
		}

		.pushbutton {
			width: 25%;
		}

		.slider {
			font-size:10px;
			margin:20px;
		}
	</style>
<body>
	<ul id="receiver"></ul>

	<div class="player">
		<div class="upper">
			<div class="mediaimage"></div>
			<div class="mediainfo"></div>
			<div class="pushbutton fa fa-5x fa-play"></div>
		</div>
		<div class="slider"></div>
	</div>

	<div id="playlist"></div>

	<script id="plTemp" type="text/x-jsrender">
		<div class="accordion">
			<h3>
				{{:title}}
				{{if url }}
					<button data-media="{{:url}}">play</button>
				{{/if}}
			</h3>
			<div>
			<p>{{:text}}</p>
			{{for children tmpl="#plTemp" /}}
			</div>
		</div>
	</script>

	<script type="text/javascript">
		(function($) {
			var player = window.player = new $.CastPlayer(fm4c.config.apikey);
			$(player).on("cast-receiver-list", function(evnt, list){
				var recList = $('#receiver');
				recList.empty();
				$.each(list, function(idx, val){
					var rec = $('<li>');
					rec.text(val.name);
					rec.on('click', val, function(e){
						player.connect(e.data);
					});
					recList.append(rec);
				});
			});

			player.init(true);

			$(".player .pushbutton").on("click", function(){
				if (player.state == 2) {
					player.pause();
				} else {
					player.play();
				}
			});

			$(".player>.slider").slider({
				disabled:true,
				min: 0,
				range: "min",
			});

			$(".player>.slider").on("slidestop", function(e, ui) {
				player.play(ui.value);
			});

			$(player).on("cast-media-player-status", function(e,s){
				var img = s.imageUrl ? "url('" + s.imageUrl + "')" : "";
				$(".player .mediaimage").css("background-image", img);
				$(".player .mediainfo").text(s.title);

				if (s.duration) {
					$(".player>.slider").slider("option", {
						value: s.position,
						max: s.duration,
						disabled: false,
					});
				} else {
					$(".player>.slider").slider("option", {
						value: 0,
						max: 1,
						disabled : true,
					});
				}
				
				if (s.state == 2) {
					$(".player .pushbutton").removeClass("fa-play").addClass("fa-pause");
				} else {
					$(".player .pushbutton").removeClass("fa-pause").addClass("fa-play");
				}

			});

			$(player).on("cast-media-status", function(e,s){
			});

			var sender = window.sender = new $.FM4Sender();
			$(sender).on("sender-new-content", function(event, content) {
				$("#playlist").html($("#plTemp").render(content));
				$("#playlist .accordion").accordion({
					heightStyle: 'content',
					collapsible: true,
					active: false
				});
				$("#playlist [data-media]").on("click", function(event){
					event.stopPropagation();
					event.preventDefault();
					var media = $(this).data("media");
					player.play(media);
				});
			});

			sender.getOnDemandInfo(sender.getOnDemandShows);
			sender.getPodcastInfo(sender.getPodcasts);

		}(jQuery));
	</script>
</body>
</html>
